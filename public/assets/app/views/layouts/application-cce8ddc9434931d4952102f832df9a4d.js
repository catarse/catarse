CATARSE.LayoutsApplicationView=Backbone.View.extend({initialize:function(){this.dropDownOpened=!1,_.bindAll(this,"render","flash","openLogin","closeLogin","submitLogin","currentUserDropDown"),CATARSE.router.route("login/*url","login_with_url",this.openLogin),CATARSE.router.route("login","login",this.openLogin),this.render()},events:{"submit .search":"search","hidden #myModal":"removeBackdrop","click #login .close":"closeLogin","click #login a.provider":"submitLogin","click a.my_profile_link":"currentUserDropDown","focus .form_login.bootstrap-form input":"markLoginForm","focus .form_register.bootstrap-form input":"markRegisterForm"},markRegisterForm:function(e){rootElement=$(e.currentTarget).closest(".bootstrap-form"),rootElement.hasClass("actived")||($(".bootstrap-form").removeClass("actived"),rootElement.addClass("actived"))},markLoginForm:function(e){rootElement=$(e.currentTarget).closest(".bootstrap-form"),rootElement.hasClass("actived")||($(".bootstrap-form").removeClass("actived"),rootElement.addClass("actived"))},openLogin:function(e){var t=null;typeof e!="undefined"?t=e:t=CATARSE.router.lastPath(),this.$("#login #return_to").val(t),this.$("#login_overlay").show(),this.$("#login").fadeIn()},closeLogin:function(e){this.$("#login #return_to").val(null),this.$("#login").hide(),this.$("#login_overlay").hide()},showModal:function(e){target=$(e.target).attr("data-target"),url=$(e.target).attr("href"),$(target).load(url),$(target).show()},removeBackdrop:function(e){this.$(".modal-backdrop").remove()},submitLogin:function(e){e.preventDefault();var t=$(e.target);t.is("a")||(t=t.parent());if(t.hasClass("disabled"))return!1;this.$("#login a.provider").addClass("disabled"),this.$("#login #provider").val(t.attr("href")),this.$("#login form").submit()},search:function(e){var t=this.$(e.target).find("#search").val();return($("#main_content").data("controller-name")!="explore"||$("#main_content").data("action")!="index")&&t.length>0&&(location.href="/explore#search/"+t),!1},flash:function(){setTimeout(function(){this.$(".flash").slideDown("slow")},100),this.$(".flash a").length||setTimeout(function(){this.$(".flash").slideUp("slow")},16e3),$(window).click(function(){this.$(".flash").slideUp()})},currentUserDropDown:function(e){e.preventDefault(),$dropdown=this.$(".dropdown.user"),this.dropDownOpened?(this.dropDownOpened=!1,$dropdown.hide()):($dropdown.show(),this.dropDownOpened=!0)},newsletterModal:function(){$("#newsletterModal").modal()},render:function(){this.flash(),this.newsletterModal()}});